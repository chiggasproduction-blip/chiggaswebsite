<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive 3D Solar System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            background-color: #000000;
        }
        #info-panel {
            transition: transform 0.5s ease-in-out;
            transform: translateX(100%);
        }
        #info-panel.visible {
            transform: translateX(0);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white">

    <div id="canvas-container" class="absolute top-0 left-0 w-full h-full"></div>

    <div class="absolute top-4 left-4 bg-black bg-opacity-50 p-4 rounded-lg shadow-lg backdrop-blur-sm">
        <h1 class="text-xl font-bold mb-2">3D Solar System</h1>
        <div class="flex space-x-2">
            <button id="solar-system-view" class="px-3 py-1 bg-blue-600 rounded-md hover:bg-blue-700 transition-colors">Solar System</button>
            <button id="asteroids-view" class="px-3 py-1 bg-gray-700 rounded-md hover:bg-gray-800 transition-colors">Asteroids</button>
            <button id="constellations-toggle" class="px-3 py-1 bg-gray-700 rounded-md hover:bg-gray-800 transition-colors">Constellations</button>
        </div>
    </div>

    <div id="info-panel" class="absolute top-0 right-0 h-full w-full max-w-sm bg-black bg-opacity-70 backdrop-blur-md p-6 overflow-y-auto shadow-2xl">
        <button id="close-panel" class="absolute top-4 right-4 text-2xl">&times;</button>
        <div id="info-content"></div>
        <div id="loader-container" class="hidden justify-center items-center h-full">
            <div class="loader"></div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        // --- CONTROLS ---
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 20;
        controls.maxDistance = 2000;
        camera.position.set(0, 250, 250);
        controls.target.set(0, 0, 0);

        // --- LIGHTING ---
        const sunLight = new THREE.PointLight(0xffffff, 3, 2000);
        scene.add(sunLight);
        const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
        scene.add(ambientLight);

        // --- STATE MANAGEMENT ---
        const celestialBodies = [];
        const orbitLines = new THREE.Group();
        scene.add(orbitLines);
        const asteroidsGroup = new THREE.Group();
        scene.add(asteroidsGroup);
        const constellationsGroup = new THREE.Group();
        scene.add(constellationsGroup);

        // --- UI ELEMENTS ---
        const solarSystemBtn = document.getElementById('solar-system-view');
        const asteroidsBtn = document.getElementById('asteroids-view');
        const constellationsToggle = document.getElementById('constellations-toggle');
        const mainViewButtons = [solarSystemBtn, asteroidsBtn];

        // --- HELPERS ---
        const textureLoader = new THREE.TextureLoader();

        function createOrbit(radius) {
            const geometry = new THREE.TorusGeometry(radius, 0.05, 16, 100);
            const material = new THREE.MeshBasicMaterial({ color: 0x444444 });
            const orbit = new THREE.Mesh(geometry, material);
            orbit.rotation.x = Math.PI / 2;
            orbitLines.add(orbit);
            return orbit;
        }

        function createCelestialBody(data) {
            const geometry = new THREE.SphereGeometry(data.radius, 64, 64);
            const material = data.emissive 
                ? new THREE.MeshStandardMaterial({ 
                    map: textureLoader.load(data.texture), 
                    emissive: 0xffddaa, 
                    emissiveIntensity: 1,
                    emissiveMap: textureLoader.load(data.texture)
                  })
                : new THREE.MeshStandardMaterial({ map: textureLoader.load(data.texture) });
            
            const body = new THREE.Mesh(geometry, material);
            body.position.x = data.distance;
            body.userData = data;
            
            const pivot = new THREE.Object3D();
            pivot.add(body);
            scene.add(pivot);

            body.userData.pivot = pivot;
            celestialBodies.push(body);

            if (data.distance > 0) {
                body.userData.orbitLine = createOrbit(data.distance);
            }
            return body;
        }
        
        // --- DATA ---
        const solarSystemData = [
            { name: 'Sun', radius: 20, distance: 0, texture: 'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/ebbf2019-9330-43af-945d-d93d81bfadc7/dg4via3-7bde39bd-4a37-4fec-8f3d-69cdd28a3ebc.png/v1/fill/w_1264,h_632,q_70,strp/venus_texture_by_planetboiearth_dg4via3-pre.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7ImhlaWdodCI6Ijw9NjQwIiwicGF0aCI6IlwvZlwvZWJiZjIwMTktOTMzMC00M2FmLTk0NWQtZDkzZDgxYmZhZGM3XC9kZzR2aWEzLTdiZGUzOWJkLTRhMzctNGZlYy04ZjNkLTY5Y2RkMjhhM2ViYy5wbmciLCJ3aWR0aCI6Ijw9MTI4MCJ9XV0sImF1ZCI6WyJ1cm46c2VydmljZTppbWFnZS5vcGVyYXRpb25zIl19.Uwx_XPXSbWeUfUUfY6hltnRxkp2gXblLKxB1O947IuQ', emissive: true, revolutionSpeed: 0, rotationSpeed: 0.001 },
            { name: 'Mercury', radius: 2, distance: 40, texture: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/27/Solarsystemscope_texture_8k_mercury.jpg/1200px-Solarsystemscope_texture_8k_mercury.jpg',emissive:true, revolutionSpeed: 0.04, rotationSpeed: 0.002 },
            { name: 'Venus', radius: 4, distance: 60, texture: 'https://assets.science.nasa.gov/dynamicimage/assets/science/cds/3d/resources/image/venus/preview.webp',emissive:true, revolutionSpeed: 0.015, rotationSpeed: 0.001 },
            { name: 'Earth', radius: 5, distance: 90, texture: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRoF91xtgLjxM2hZJwYZ77_nU33S0ZrGdeOBw&s',emissive:true, revolutionSpeed: 0.01, rotationSpeed: 0.02 },
            { name: 'Mars', radius: 3, distance: 120, texture: 'https://assets.science.nasa.gov/dynamicimage/assets/science/cds/3d/resources/image/mars/preview.webp',emissive:true, revolutionSpeed: 0.008, rotationSpeed: 0.018 },
            { name: 'Jupiter', radius: 12, distance: 180, texture: 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/Solarsystemscope_texture_8k_jupiter.jpg/2560px-Solarsystemscope_texture_8k_jupiter.jpg',emissive:true, revolutionSpeed: 0.002, rotationSpeed: 0.04 },
            { name: 'Saturn', radius: 10, distance: 250, texture: 'https://upload.wikimedia.org/wikipedia/commons/1/1e/Solarsystemscope_texture_8k_saturn.jpg',emissive:true, revolutionSpeed: 0.001, rotationSpeed: 0.038 },
            { name: 'Uranus', radius: 7, distance: 320, texture: 'https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Solarsystemscope_texture_2k_uranus.jpg/1600px-Solarsystemscope_texture_2k_uranus.jpg',emissive:true, revolutionSpeed: 0.0005, rotationSpeed: 0.03 },
            { name: 'Neptune', radius: 7, distance: 400, texture: 'https://assets.science.nasa.gov/dynamicimage/assets/science/cds/3d/resources/image/neptune/preview.webp',emissive:true, revolutionSpeed: 0.0003, rotationSpeed: 0.029 }
        ];

        solarSystemData.forEach(createCelestialBody);

        // --- ASTEROID BELTS ---
        function createAllAsteroidGroups() {
            function createPointGroup(positions, color) {
                const geometry = new THREE.BufferGeometry();
                geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
                const material = new THREE.PointsMaterial({
                    color: color,
                    size: 0.5,
                    blending: THREE.AdditiveBlending,
                    transparent: true,
                    opacity: 0.7
                });
                const points = new THREE.Points(geometry, material);
                asteroidsGroup.add(points);
            }

            const greyColor = 0xaaaaaa;

            const mainBeltPositions = [];
            for (let i = 0; i < 4000; i++) {
                const angle = Math.random() * Math.PI * 2;
                const radius = 130 + Math.random() * 40;
                const y = (Math.random() - 0.5) * 8;
                mainBeltPositions.push(Math.cos(angle) * radius, y, Math.sin(angle) * radius);
            }
            createPointGroup(mainBeltPositions, greyColor);

            const jupiterOrbit = 180;
            const trojanPositions = [];
            for (let i = 0; i < 1000; i++) {
                const angle = (Math.PI / 3) + (Math.random() - 0.5) * (Math.PI / 4);
                const radius = jupiterOrbit + (Math.random() - 0.5) * 30;
                const y = (Math.random() - 0.5) * 8;
                trojanPositions.push(Math.cos(angle) * radius, y, Math.sin(angle) * radius);
            }
            for (let i = 0; i < 1000; i++) {
                const angle = -(Math.PI / 3) + (Math.random() - 0.5) * (Math.PI / 4);
                const radius = jupiterOrbit + (Math.random() - 0.5) * 30;
                const y = (Math.random() - 0.5) * 8;
                trojanPositions.push(Math.cos(angle) * radius, y, Math.sin(angle) * radius);
            }
            createPointGroup(trojanPositions, greyColor);

            const hildaPositions = [];
            for (let i = 0; i < 800; i++) {
                const baseAngle = Math.floor(Math.random() * 3) * (2 * Math.PI / 3);
                const angle = baseAngle + (Math.random() - 0.5) * (Math.PI / 3);
                const radius = 170 + (Math.random() - 0.5) * 15;
                const y = (Math.random() - 0.5) * 8;
                hildaPositions.push(Math.cos(angle) * radius, y, Math.sin(angle) * radius);
            }
            createPointGroup(hildaPositions, greyColor);

            asteroidsGroup.visible = false;
        }
        createAllAsteroidGroups();

        function createStarfield() {
            const starCount = 10000;
            const positions = new Float32Array(starCount * 3);
            for (let i = 0; i < starCount; i++) {
                positions[i * 3 + 0] = (Math.random() - 0.5) * 4000;
                positions[i * 3 + 1] = (Math.random() - 0.5) * 4000;
                positions[i * 3 + 2] = (Math.random() - 0.5) * 4000;
            }
            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const material = new THREE.PointsMaterial({ color: 0xffffff, size: 1.5 });
            const stars = new THREE.Points(geometry, material);
            scene.add(stars);
        }
        createStarfield();

        // --- EVENT LISTENERS & UI LOGIC ---
        // *** FIX: New function to handle exclusive button highlighting ***
        function updateMainButtonStyles(activeButton) {
            mainViewButtons.forEach(button => {
                if (button === activeButton) {
                    button.classList.remove('bg-gray-700', 'hover:bg-gray-800');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                } else {
                    button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                    button.classList.add('bg-gray-700', 'hover:bg-gray-800');
                }
            });
        }
        
        solarSystemBtn.addEventListener('click', () => {
             asteroidsGroup.visible = false;
             orbitLines.visible = true;
             celestialBodies.forEach(b => b.parent.visible = true);
             updateMainButtonStyles(solarSystemBtn);
        });

        asteroidsBtn.addEventListener('click', () => {
             asteroidsGroup.visible = true;
             orbitLines.visible = true;
             celestialBodies.forEach(b => b.parent.visible = true);
             updateMainButtonStyles(asteroidsBtn);
        });
        
        constellationsToggle.addEventListener('click', (e) => {
            constellationsGroup.visible = !constellationsGroup.visible;
             if (constellationsGroup.visible) {
                e.target.classList.remove('bg-gray-700', 'hover:bg-gray-800');
                e.target.classList.add('bg-blue-600', 'hover:bg-blue-700');
            } else {
                e.target.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                e.target.classList.add('bg-gray-700', 'hover:bg-gray-800');
            }
        });

        // --- ANIMATION LOOP ---
        function animate() {
            requestAnimationFrame(animate);

            celestialBodies.forEach(body => {
                const data = body.userData;
                if (data.pivot) {
                    data.pivot.rotation.y += (data.revolutionSpeed || 0) * 0.1;
                }
                body.rotation.y += (data.rotationSpeed || 0);
            });

            if (asteroidsGroup.visible) {
                asteroidsGroup.rotation.y += 0.0002;
            }

            controls.update();
            renderer.render(scene, camera);
        }
        animate();
    </script>
</body>
</html>