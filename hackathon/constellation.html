<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D & 3D Constellation Guide</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js for 3D rendering in the modal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        /* Custom styles for a deep space theme */
        body {
            font-family: 'Inter', sans-serif;
            /* Updated background to use the new wallpaper */
            background-image: url('https://c4.wallpaperflare.com/wallpaper/824/766/324/nebula-4k-teal-turquoise-wallpaper-preview.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        /* Style for the constellation cards */
        .constellation-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            background-color: rgba(12, 20, 39, 0.5); /* Semi-transparent background */
            backdrop-filter: blur(2px); /* Frosted glass effect */
        }
        .constellation-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(118, 209, 255, 0.5);
        }
        /* SVG styles for stars and lines */
        .star {
            fill: #ffffff;
        }
        .constellation-line {
            stroke: rgba(118, 209, 255, 0.7);
            stroke-width: 1;
        }
        /* Modal styles */
        .modal-backdrop {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
            /* Added background image with a lighter overlay to make the stars more visible */
            background-image: linear-gradient(rgba(12, 20, 39, 0.7), rgba(12, 20, 39, 0.7)), url('https://c4.wallpaperflare.com/wallpaper/455/205/165/fantasy-art-digital-art-artwork-science-fiction-wallpaper-preview.jpg');
            background-size: cover;
            background-position: center;
        }
        #d-container canvas {
            cursor: grab;
        }
        #d-container canvas:active {
            cursor: grabbing;
        }
    </style>
    <!-- Google Fonts for typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="text-white">

    <!-- Header Section -->
    <header class="text-center p-8">
        <h1 class="text-4xl font-bold mb-2">Interactive Constellation Guide</h1>
        <p class="text-lg text-gray-400">Click on a constellation to see it in 3D.</p>
    </header>

    <!-- Grid for displaying constellations -->
    <main id="constellation-grid" class="p-4 md:p-8 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-6">
        <!-- Constellation cards will be injected here by JavaScript -->
    </main>

    <!-- Modal for displaying constellation details -->
    <div id="modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <!-- Backdrop -->
        <div id="modal-backdrop" class="absolute inset-0 bg-black bg-opacity-70"></div>
        <!-- Modal Content -->
        <div id="modal-content" class="relative bg-gray-800 border border-gray-700 rounded-lg shadow-xl w-full max-w-lg p-6 transform scale-95 opacity-0">
            <h2 id="modal-name" class="text-3xl font-bold text-cyan-300 mb-4"></h2>
            <!-- Container for the 3D scene -->
            <div id="d-container" class="w-full h-64 md:h-80 bg-black bg-opacity-25 rounded-md mb-4 border border-gray-700"></div>
            <p id="modal-story" class="text-gray-300"></p>
            <button id="modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button>
        </div>
    </div>

    <script type="module">
        // --- 3D SCENE VARIABLES ---
        let scene3d, camera3d, renderer3d, controls3d, animationFrameId;

        // --- CONSTELLATION DATA ---
        // Expanded to 30 constellations with x, y, z coordinates.
        const constellationData = {
            "UMa": { name: "Ursa Major", story: "Known as the Great Bear, this constellation contains the Big Dipper.", stars: [{x:-40,y:0,z:5},{x:-20,y:-5,z:-5},{x:0,y:0,z:0},{x:20,y:5,z:10},{x:40,y:-25,z:-10},{x:25,y:-30,z:5},{x:10,y:-35,z:-5}], lines: [[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[3,6]]},
            "Ori": { name: "Orion", story: "Orion is the Hunter, one of the most recognizable constellations.", stars: [{x:-35,y:35,z:10},{x:-30,y:-30,z:-5},{x:30,y:-35,z:5},{x:35,y:30,z:-10},{x:-5,y:-5,z:0},{x:0,y:0,z:10},{x:5,y:5,z:-5},{x:0,y:30,z:5},{x:0,y:-30,z:0}], lines: [[0,4],[1,6],[2,5],[3,4],[4,5],[5,6],[0,7],[3,7],[1,8],[2,8]]},
            "Cas": { name: "Cassiopeia", story: "This W-shaped constellation is named after a vain queen in Greek mythology.", stars: [{x:-40,y:20,z:0},{x:-20,y:-10,z:10},{x:0,y:20,z:-5},{x:20,y:-10,z:5},{x:40,y:20,z:-10}], lines: [[0,1],[1,2],[2,3],[3,4]]},
            "Cyg": { name: "Cygnus", story: "Known as the Swan or the Northern Cross, Cygnus flies along the Milky Way.", stars: [{x:0,y:40,z:0},{x:0,y:-40,z:5},{x:-30,y:0,z:-10},{x:30,y:0,z:10},{x:0,y:0,z:0}], lines: [[0,4],[1,4],[2,4],[3,4]]},
            "Leo": { name: "Leo", story: "Leo represents the Nemean Lion, a beast with an impenetrable hide that was killed by Hercules.", stars: [{x:-40,y:0,z:5},{x:-25,y:20,z:-5},{x:-10,y:30,z:0},{x:5,y:20,z:10},{x:20,y:0,z:-10},{x:40,y:-10,z:5},{x:5,y:-20,z:0}], lines: [[0,1],[1,2],[2,3],[3,4],[4,5],[4,6],[0,6]]},
            "Sco": { name: "Scorpius", story: "The Scorpion, with its distinctive curved tail and bright red star Antares at its heart.", stars: [{x:-30,y:30,z:0},{x:-20,y:20,z:10},{x:-10,y:25,z:-5},{x:10,y:0,z:5},{x:20,y:-20,z:-10},{x:10,y:-35,z:0},{x:30,y:-40,z:5}], lines: [[0,1],[1,2],[2,3],[3,4],[4,5],[5,6]]},
            "And": { name: "Andromeda", story: "The chained maiden from Greek mythology, saved by the hero Perseus.", stars: [{x:-30,y:30,z:10},{x:0,y:10,z:-5},{x:30,y:-10,z:5},{x:0,y:-30,z:0}], lines: [[0,1],[1,2],[1,3]]},
            "Aql": { name: "Aquila", story: "The eagle that carried Zeus's thunderbolts.", stars: [{x:0,y:30,z:0},{x:-15,y:0,z:10},{x:15,y:0,z:-10},{x:0,y:-30,z:5}], lines: [[0,3],[1,3],[2,3]]},
            "Ari": { name: "Aries", story: "The ram with the Golden Fleece.", stars: [{x:-20,y:10,z:0},{x:0,y:0,z:10},{x:20,y:5,z:-5}], lines: [[0,1],[1,2]]},
            "Aur": { name: "Auriga", story: "The charioteer, holding a goat and her kids.", stars: [{x:0,y:30,z:0},{x:-30,y:0,z:10},{x:30,y:0,z:-10},{x:-20,y:-30,z:-5},{x:20,y:-30,z:5}], lines: [[0,1],[0,2],[1,3],[2,4],[3,4]]},
            "Boo": { name: "Bo√∂tes", story: "The herdsman, often seen following the Great Bear.", stars: [{x:0,y:40,z:0},{x:-20,y:10,z:10},{x:20,y:10,z:-10},{x:0,y:-40,z:5},{x:-15,y:-20,z:-5},{x:15,y:-20,z:5}], lines: [[0,1],[0,2],[1,4],[2,5],[4,3],[5,3]]},
            "Cnc": { name: "Cancer", story: "The crab sent to distract Hercules.", stars: [{x:-15,y:10,z:0},{x:0,y:0,z:10},{x:15,y:10,z:-5},{x:0,y:-20,z:5}], lines: [[0,1],[1,2],[1,3]]},
            "CMa": { name: "Canis Major", story: "The great dog, containing Sirius, the brightest star.", stars: [{x:-30,y:-20,z:0},{x:0,y:10,z:10},{x:30,y:0,z:-10},{x:15,y:-30,z:5}], lines: [[0,1],[1,2],[1,3]]},
            "CMi": { name: "Canis Minor", story: "The lesser dog, companion to Canis Major.", stars: [{x:-10,y:10,z:0},{x:10,y:-10,z:10}], lines: [[0,1]]},
            "Cap": { name: "Capricornus", story: "The sea-goat, a mythical creature.", stars: [{x:-30,y:0,z:0},{x:-10,y:20,z:10},{x:10,y:10,z:-5},{x:30,y:-20,z:5},{x:0,y:-30,z:-10}], lines: [[0,1],[1,2],[2,3],[3,4],[4,0]]},
            "Cen": { name: "Centaurus", story: "A wise centaur, often identified as Chiron.", stars: [{x:-40,y:-30,z:0},{x:-20,y:0,z:10},{x:10,y:10,z:-5},{x:30,y:0,z:5},{x:20,y:-30,z:-10}], lines: [[0,1],[1,2],[2,3],[3,4]]},
            "Cep": { name: "Cepheus", story: "The king of Ethiopia, husband of Cassiopeia.", stars: [{x:0,y:30,z:0},{x:-25,y:0,z:10},{x:25,y:0,z:-10},{x:-25,y:-30,z:-5},{x:25,y:-30,z:5}], lines: [[0,1],[0,2],[1,3],[2,4],[3,4]]},
            "Cet": { name: "Cetus", story: "The sea monster sent to devour Andromeda.", stars: [{x:-40,y:0,z:0},{x:-20,y:20,z:10},{x:10,y:10,z:-5},{x:30,y:-10,z:5},{x:20,y:-30,z:-10},{x:-10,y:-20,z:0}], lines: [[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]]},
            "CrB": { name: "Corona Borealis", story: "The northern crown, belonging to Ariadne.", stars: [{x:-30,y:0,z:0},{x:-15,y:25,z:10},{x:15,y:25,z:-5},{x:30,y:0,z:5},{x:20,y:-20,z:-10},{x:0,y:-25,z:0},{x:-20,y:-20,z:5}], lines: [[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,0]]},
            "Crv": { name: "Corvus", story: "The crow, messenger of the god Apollo.", stars: [{x:-15,y:15,z:0},{x:15,y:15,z:10},{x:10,y:-15,z:-5},{x:-10,y:-15,z:5}], lines: [[0,1],[1,2],[2,3],[3,0]]},
            "Cru": { name: "Crux", story: "The Southern Cross, a guidepost in the southern sky.", stars: [{x:0,y:30,z:0},{x:0,y:-30,z:10},{x:-20,y:0,z:-5},{x:20,y:0,z:5}], lines: [[0,1],[2,3]]},
            "Del": { name: "Delphinus", story: "The dolphin, placed in the sky by Poseidon.", stars: [{x:-10,y:15,z:0},{x:10,y:15,z:10},{x:20,y:0,z:-5},{x:0,y:-10,z:5},{x:-20,y:0,z:-10}], lines: [[0,1],[1,2],[2,3],[3,4],[4,0]]},
            "Dra": { name: "Draco", story: "The dragon that guarded the golden apples.", stars: [{x:30,y:30,z:0},{x:10,y:20,z:10},{x:-10,y:30,z:-5},{x:-30,y:10,z:5},{x:-20,y:-10,z:-10},{x:0,y:-30,z:0},{x:20,y:-20,z:5}], lines: [[0,1],[1,2],[2,3],[3,4],[4,5],[5,6]]},
            "Gem": { name: "Gemini", story: "The twins, Castor and Pollux.", stars: [{x:-20,y:40,z:0},{x:20,y:40,z:10},{x:-15,y:0,z:-5},{x:15,y:0,z:5},{x:-10,y:-40,z:-10},{x:10,y:-40,z:0}], lines: [[0,2],[2,4],[1,3],[3,5],[2,3]]},
            "Her": { name: "Hercules", story: "The great hero known for his incredible strength.", stars: [{x:-20,y:30,z:0},{x:20,y:30,z:10},{x:30,y:0,z:-5},{x:-30,y:0,z:5},{x:-20,y:-30,z:-10},{x:20,y:-30,z:0}], lines: [[0,1],[1,2],[2,5],[5,4],[4,3],[3,0]]},
            "Hya": { name: "Hydra", story: "The largest constellation, the water serpent.", stars: [{x:-40,y:0,z:0},{x:-20,y:10,z:10},{x:0,y:0,z:-5},{x:20,y:10,z:5},{x:40,y:0,z:-10}], lines: [[0,1],[1,2],[2,3],[3,4]]},
            "Lyr": { name: "Lyra", story: "The lyre of the great musician Orpheus.", stars: [{x:0,y:20,z:0},{x:-15,y:0,z:10},{x:15,y:0,z:-5},{x:-20,y:-20,z:5},{x:20,y:-20,z:-10}], lines: [[0,1],[0,2],[1,3],[2,4]]},
            "Peg": { name: "Pegasus", story: "The mythical winged horse.", stars: [{x:-30,y:30,z:0},{x:30,y:30,z:10},{x:30,y:-30,z:-5},{x:-30,y:-30,z:5},{x:0,y:0,z:0}], lines: [[0,1],[1,2],[2,3],[3,0]]},
            "Per": { name: "Perseus", story: "The hero who saved Andromeda.", stars: [{x:0,y:30,z:0},{x:-20,y:0,z:10},{x:20,y:10,z:-5},{x:-10,y:-30,z:5},{x:30,y:-20,z:-10}], lines: [[0,1],[1,2],[2,3],[2,4]]},
            "Sgr": { name: "Sagittarius", story: "The Archer, often depicted as a centaur.", stars: [{x:-30,y:10,z:0},{x:-10,y:0,z:10},{x:10,y:5,z:-5},{x:20,y:20,z:5},{x:35,y:0,z:-10},{x:15,y:-20,z:0},{x:-10,y:-30,z:5}], lines: [[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,1],[2,5]]},
        };

        // --- DOM ELEMENTS ---
        const grid = document.getElementById('constellation-grid');
        const modal = document.getElementById('modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        const modalName = document.getElementById('modal-name');
        const modalStory = document.getElementById('modal-story');
        const modalClose = document.getElementById('modal-close');
        
        // --- 2D GRID FUNCTIONS ---
        function populateGrid() {
            for (const key in constellationData) {
                const data = constellationData[key];
                const card = document.createElement('div');
                card.className = 'constellation-card border border-gray-700 rounded-lg p-4 cursor-pointer aspect-square flex flex-col items-center justify-center';
                card.dataset.key = key;
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('viewBox', '0 0 100 100');
                svg.setAttribute('class', 'w-full h-full');
                data.lines.forEach(lineIndices => {
                    const startStar = data.stars[lineIndices[0]];
                    const endStar = data.stars[lineIndices[1]];
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', startStar.x + 50); line.setAttribute('y1', -startStar.y + 50);
                    line.setAttribute('x2', endStar.x + 50); line.setAttribute('y2', -endStar.y + 50);
                    line.setAttribute('class', 'constellation-line');
                    svg.appendChild(line);
                });
                data.stars.forEach(star => {
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', star.x + 50); circle.setAttribute('cy', -star.y + 50);
                    circle.setAttribute('r', '1.5');
                    circle.setAttribute('class', 'star');
                    svg.appendChild(circle);
                });
                card.appendChild(svg);
                const label = document.createElement('p');
                label.className = "text-center text-gray-300 mt-2 font-semibold";
                label.textContent = data.name;
                card.appendChild(label);
                grid.appendChild(card);
            }
        }

        // --- MODAL FUNCTIONS ---
        function showModal(key) {
            const data = constellationData[key];
            modalName.textContent = data.name;
            modalStory.textContent = data.story;
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.classList.add('opacity-100');
                modalContent.classList.remove('scale-95', 'opacity-0');
                init3D(document.getElementById('d-container'), data);
            }, 10);
        }

        function hideModal() {
            modalBackdrop.classList.remove('opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                cleanup3D();
            }, 300);
        }

        // --- 3D SCENE FUNCTIONS ---
        function init3D(container, data) {
            scene3d = new THREE.Scene();
            camera3d = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera3d.position.z = 80;
            renderer3d = new THREE.WebGLRenderer({ antialias: true, alpha: true }); // alpha: true for transparent background
            renderer3d.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer3d.domElement);
            controls3d = new THREE.OrbitControls(camera3d, renderer3d.domElement);
            controls3d.enableDamping = true;
            controls3d.dampingFactor = 0.1;
            controls3d.autoRotate = true;
            controls3d.autoRotateSpeed = 0.5;
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene3d.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 0.8);
            pointLight.position.set(50, 50, 50);
            scene3d.add(pointLight);
            const starMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, emissive: 0xddddff, roughness: 0.5, metalness: 0.2 });
            data.stars.forEach(starPos => {
                const starGeometry = new THREE.SphereGeometry(1.5, 32, 32);
                const star = new THREE.Mesh(starGeometry, starMaterial);
                star.position.set(starPos.x, starPos.y, starPos.z);
                scene3d.add(star);
            });
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x76d1ff, transparent: true, opacity: 0.8 });
            const points = [];
            data.lines.forEach(lineIndices => {
                const startStar = data.stars[lineIndices[0]];
                const endStar = data.stars[lineIndices[1]];
                points.push(new THREE.Vector3(startStar.x, startStar.y, startStar.z));
                points.push(new THREE.Vector3(endStar.x, endStar.y, endStar.z));
            });
            const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
            const lines = new THREE.LineSegments(lineGeometry, lineMaterial);
            scene3d.add(lines);
            animate3D();
        }

        function animate3D() {
            animationFrameId = requestAnimationFrame(animate3D);
            controls3d.update();
            renderer3d.render(scene3d, camera3d);
        }

        function cleanup3D() {
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            if (scene3d) {
                scene3d.traverse(object => {
                    if (object.isMesh || object.isLine) {
                        if (object.geometry) object.geometry.dispose();
                        if (object.material) {
                            if (Array.isArray(object.material)) {
                                object.material.forEach(material => material.dispose());
                            } else {
                                object.material.dispose();
                            }
                        }
                    }
                });
            }
            if (renderer3d) {
                renderer3d.dispose();
                const container = document.getElementById('d-container');
                if(container && renderer3d.domElement) {
                    container.removeChild(renderer3d.domElement);
                }
            }
            scene3d = null; camera3d = null; renderer3d = null; controls3d = null;
        }

        // --- EVENT LISTENERS ---
        grid.addEventListener('click', (event) => {
            const card = event.target.closest('.constellation-card');
            if (card && card.dataset.key) {
                showModal(card.dataset.key);
            }
        });
        modalClose.addEventListener('click', hideModal);
        modalBackdrop.addEventListener('click', hideModal);

        // --- INITIALIZATION ---
        populateGrid();
    </script>
</body>
</html>